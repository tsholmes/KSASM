.ifndef libdevice { .macro libdevice
.ns device.

.macro define(id, fields) {
  data:
    fields
  data.end:
  :p24 _setup_data: .addns(data) $(.addns(data.end) - .addns(data)) id 0
  .macro init devmap*2:p24 ..addns(_setup_data)+0, +6
}

.endns
}